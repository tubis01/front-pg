
<shared-menu
*ngIf="isDigitador"
></shared-menu>

<h1>{{ beneficiarioToEdit ? 'Actualizar Beneficiario' : 'Registrar Beneficiario' }}</h1>

<p-divider></p-divider>

<div class="grid">
  <div class="col-12 sm:col-6 md:col-3">
    <p-card class="grid">
      <div class="grid form-scroll-container">
        <form [formGroup]="beneficiarioForm" (ngSubmit)="onSubmit()" class="p-fluid grid">

          <input type="hidden" formControlName="id" />

          <!-- Campo DPI -->
          <div class="col-12 form-field" [ngClass]="{ 'has-error': isFieldInvalid('dpi') }">
            <label for="dpi">DPI</label>
            <input pInputText id="dpi" formControlName="dpi" placeholder="DPI" required  [readOnly]="beneficiarioToEdit ? true : false" />
            <div class="error-message" *ngIf="isFieldInvalid('dpi')">
              El campo DPI es obligatorio.
            </div>
          </div>

          <!-- Autocomplete para Proyecto -->
        <!-- Autocomplete para Proyecto -->
        <div class="col-12 form-field" [ngClass]="{ 'has-error': isFieldInvalid('proyecto') }">
          <label for="proyecto">Proyecto</label>
          <p-autoComplete
            [inputStyle]="{'width': '100%'}"
            [suggestions]="filteredProjects"
            (completeMethod)="buscarProyectos($event)"
            (onSelect)="onProyectoSeleccionado($event)"
            [forceSelection]="true"
            [dropdown]="true"
            field="nombreCompleto"
            [minLength]="1"
            placeholder="Selecciona un proyecto">
          </p-autoComplete>
          <!-- Campo oculto para enviar solo el ID del proyecto -->
          <input type="hidden" formControlName="proyecto">
          <div class="error-message" *ngIf="isFieldInvalid('proyecto')">
            <ng-container *ngIf="beneficiarioForm.get('proyecto')?.errors?.['required']">
              El campo Proyecto es obligatorio.
            </ng-container>
          </div>
        </div>
          <!-- Bot칩n para cargar m치s proyectos -->
          <div class="col-12" *ngIf="nextPageUrl">
            <button pButton label="Cargar m치s proyectos" (click)="cargarMasProyectos()" type="button"></button>
          </div>

          <!-- Bot칩n para guardar -->
          <div class="col-12">
            <button pButton type="submit" label="{{ beneficiarioToEdit ? 'Actualizar' : 'Guardar' }}"></button>
          </div>
        </form>
      </div>
    </p-card>
  </div>
</div>
